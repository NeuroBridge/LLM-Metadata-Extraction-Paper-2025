Title.
Classification of multi-site MR images in the presence of heterogeneity using multi-task learning☆.
Abstract.
With the advent of Big Data Imaging Analytics applied to neuroimaging, datasets from multiple sites need to be pooled into larger samples. However, heterogeneity across different scanners, protocols and populations, renders the task of finding underlying disease signatures challenging. The current work investigates the value of multi-task learning in finding disease signatures that generalize across studies and populations. Herein, we present a multi-task learning type of formulation, in which different tasks are from different studies and populations being pooled together. We test this approach in an MRI study of the neuroanatomy of schizophrenia (SCZ) by pooling data from 3 different sites and populations: Philadelphia, Sao Paulo and Tianjin (50 controls and 50 patients from each site), which posed integration challenges due to variability in disease chronicity, treatment exposure, and data collection. Some existing methods are also tested for comparison purposes. Experiments show that classification accuracy of multi-site data outperformed that of single-site data and pooled data using multi-task feature learning, and also outperformed other comparison methods. Several anatomical regions were identified to be common discriminant features across sites. These included prefrontal, superior temporal, insular, anterior cingulate cortex, temporo-limbic and striatal regions consistently implicated in the pathophysiology of schizophrenia, as well as the cerebellum, precuneus, and fusiform, middle temporal, inferior parietal, postcentral, angular, lingual and middle occipital gyri. These results indicate that the proposed multi-task learning method is robust in finding consistent and reliable structural brain abnormalities associated with SCZ across different sites, in the presence of multiple sources of heterogeneity.
Highlights.
Multi-task learning is tested to classify MRI data of 3 sites (50 controls and 50 schizophrenia patients from each site).
Classification accuracy of multi-site data outperformed that of single-site and pooled data.
Several cortical and subcortical anatomical regions were found to be common discriminant features across different sites.
Multi-task learning is robust in finding reliable structural brain abnormalities of schizophrenia across different sites.
Introduction.
Neuroimaging studies have widely explored the clinical value of machine learning methods for differentiating psychiatric patients from healthy controls at the individual level. In addition to providing individualized indices for diagnostic purposes, machine learning methods may ultimately help identify brain regions affected by disease in subtle ways that can only be elucidated using multi-variate analysis. While most of these neuroimaging studies to date have been performed using single-site datasets, it is essential to integrate multi-site data for two reasons. First, multi-site data provide sufficient statistical power for detecting subtle, but informative patterns of brain structure and function, which may be difficult to unravel with the relative small sample sizes usually acquired in single centers. Second, large sample sizes enhance sample generalizability by pooling large patient populations with diverse demographic features and clinical characteristics including disease onset, symptom severity, and types and duration of treatment. Multi-site studies are therefore becoming increasingly the norm in neuroimaging research.
Multi-site data reflect a more comprehensive abnormal pattern of disease, and therefore may provide a richer understanding of disease signatures than single-site data. However, two recent studies found that simple pooling of multi-site data did not outperform single-site disease classification. Colby and Nielsen pooled multi-site data and trained a common classifier for all data, to identify attention deficit hyperactivity disorder (ADHD) and autism, respectively. Results in these two studies showed that the pooled dataset exhibited lower accuracy than each single-site datasets. Here we seek a new approach to synergistically integrating multi-site data, by emphasizing two points. First, since datasets collected in multiple imaging centers have a common disorder of interest (e.g. schizophrenia (SCZ), in our experiments herein), the abnormal patterns in each dataset are strongly related and thus, to some extent, may share a common imaging signature. The pattern reproducibility among multi-site data has been repeatedly demonstrated in several multi-site studies on functional MRI (fMRI), morphometric MRI, and diffusion-tensor imaging (DTI). Most of these studies arrived at similar conclusions, namely that with appropriate multi-site data collection, different data sites shared highly consistent feature patterns. With this, the site-shared features reveal consistent brain abnormalities in multi-site data, which can lead to a more accurate neurobiological understanding of the psychiatric disorder under investigation. On the other hand, though the integration of multiple single-site data is advantageous, the unavoidable presence of site-specific features might decrease the accuracy of a classifier that merely pools data together across studies. Heterogeneity can emanate from multiple sources including scanner differences, differences in image acquisition protocols, or ethnic and treatment differences among participating patient populations. Given such site-related heterogeneity, multi-site datasets should not simply be merged into larger cohorts for further machine learning investigation. In an attempt to eliminate or reduce the site-specific variability, studies have suggested same scanning protocols, consistent scanner parameters and etc. in data collection, as well as the utilization of smoothness equalization and independent component analysis in data preprocessing. Despite these efforts, site-specific heterogeneities still exist due to their complex causes.
The above considerations highlight the need for a feature-learning framework in multi-site disease classification that can extract the site-shared features, while also accounting for the site-specific features; this approach generally seeks an overarching signature of disease, whereas it accommodates potential sub-cohort and other differences to be taken into consideration. In recent years, multi-task learning has been successful in learning task-shared and task-specific features simultaneously, which effectively improves generalization compared with traditional machine learning methods. For example, support vector machine (SVM) with single-task learning learns a distinct feature pattern and finds a maximum margin hyperplane to classify two groups, which extracts information within a single learning task. In contrast, multi-task learning extracts a subset of task-shared features to generate more accurate models on multiple tasks, with the task-specific features learned simultaneously. The basic assumption of multi-task learning is that the feature weights of different tasks share similar sparse patterns, which can be learned by imposing sparsity regularization penalties on the task weight matrix. l1-norm and l2,1-norm are two commonly used sparsity regulating terms in multi-task learning, which enforces the weight matrix of different tasks to be sparse across all tasks. Particularly, an l1-norm term highlights task-specific features by encouraging the weights of irrelevant features to be very small, while l2,1-norm introduces group sparsity and enforces task-shared features to have larger weights.
The advantage of multi-task learning makes it suitable for multi-site data learning, considering the site as task, and the site-shared and site-specific features as task-shared and task-specific features. Neuroimaging studies have shown the effectiveness of performing multi-task learning in the brain decoding and disease classification. Specifically, multi-site fMRI data of ADHD was demonstrated better than single-site classification by learning site-shared and site-specific features using multi-task scheme. In this work, though the multi-task learning scheme successfully extracted site-shared and site-specific features in multi-site data, the form of the objective function was rather complex and specific as it included an l2,1-norm group sparsity regularization term and a 6-D spatial structure penalty (generated by the GraphNet, fused Lasso, or the isotropic total variation). In order to make the multi-task learning scheme more simple and applicable, an objective function including l1-norm and l2,1-norm penalty terms was used in the current study.
Building upon this emerging literature, we aim to distinguish SCZ patients from healthy controls across multiple-site MRI data using multi-task learning. We hypothesized that using multi-task learning framework on multi-site classification would not only have better performance than single-site data classification, but would also identify the abnormalities shared by all sites, and also specific to each site. These site-shared brain structural alterations should be consistent with the previously reported altered regions in SCZ, such as the brain regions involving prefrontal, superior temporal, insular, temporo-limbic regions, among others.
Materials and methods.
Participants and MRI acquisitions.
MRI data were collected by three academic centers, including locations in the United States (University of Pennsylvania; site A), Brazil (University of Sao Paulo; site B), and China (Tianjin; site C). From each site, a balanced dataset was obtained with 50 normal controls (NCs) and 50 SCZ patients randomly selected from a larger pool of available subjects. In total, we had 150 NCs and 150 SCZs, which didn't differ by age and gender significantly (p > 0.05; see Table 1).
All SCZ patients met DSM-IV criteria. Written informed consent was obtained from all participants before MRI scanning. In site A, the 50 SCZ patients had chronic symptoms and were receiving treatment with antipsychotics (mean duration of illness 16.2 ± 12.3 years). In site B, all SCZ subjects were recruited shortly after they made their first contact with mental health services due to psychotic symptoms, and their duration of illness was 1.0 ± 1.3 years; 31 patients had been on antipsychotic treatment within 3 weeks of MRI, while the remaining 19 patients were free of antipsychotics at the time of MRI scanning. Site C contributed 5 first-episode, never-treated SCZ patients and 45 chronic SCZ patients under antipsychotic treatment (mean duration of illness 10.5 ± 7.2 years).
In site A, the imaging data were acquired using a Siemens Trio 3-T scanner (Siemens Medical Systems, Erlangen Germany), with the following protocol: slice thickness = 1 mm, TE = 3.51 ms, TR = 18.1 ms, flip angle = 9°, acquisition matrix = 240 × 180, and slice number = 160, no gaps, 1-mm isotropic voxels. In site B, the T1 images were acquired using two identical 1.5-T GE Signa scanners (GE Medical Systems, Milwaukee WI, USA) with the following protocol: T1-SPGR sequence providing 124 contiguous slices, TE = 5.2 ms, TR = 21.7 ms, flip angle = 20°, FOV = 22 cm, acquisition matrix = 256 × 192. Details of the MRI scanning in site B can be found in. In site C, all scans were obtained using a GE 3-T Signa scanner (GE Medical Systems, Milwaukee WI, USA) with the following protocol: slice thickness = 1 mm, TE = 3.2 ms, TR = 8.2 ms, flip angle = 12°, acquisition matrix = 256 × 256, FOV = 25.6 cm.
Preprocessing.
The imaging data were preprocessed using the following steps as previously described: (1) skull stripping, (2) bias field correction, (3) brain tissue segmentation into gray matter (GM), white matter (WM), cerebrospinal fluid (CSF), (4) spatial registration to Montreal Neurological Institute (MNI) template, (5) generation of the Regional Analysis of Volumes Examined in Normalized Space (RAVENS) maps of GM, WM, and CSF using deformable registration (DRAMMS), and (6) spatial smoothing of RAVENS maps using a 6-mm Full Width at Half Maximum (FWHM) Gaussian filter. In our study, we investigated the RAVENS value changes in the GM images, which indicated regional GM volumetric alterations in the brain. Note that the RAVENS method has been demonstrated to provide more accurate and reliable quantification of volumes of different brain regions. In order to reduce computational requirements, and since SCZ is not known to be associated with very localized volumetric reductions, the GM RAVENS maps were resampled to have a spatial resolution of 3 × 3 × 3 mm3. After applying a GM mask, 66,732 voxel-wise features for each subject were extracted. These images yielded a feature matrix of dimensionality of 100 × 66,732 for each site dataset. In order to ensure that features in each site are within the same level and contribute equally in the process of feature weight learning, the feature matrices were then standardized to zero mean and unit variance across all subjects within each site, respectively.
Multi-site classification using multi-task learning framework.
In our study, the multi-task learning framework was used to learn the site-shared and site-specific features in the three data sites. These selected features were then used to classify the different data sites respectively. The workflow of multi-site learning is shown in Fig. 1.
We model the classification between SCZs and NCs of different sites as a multi-task learning problem with t learning tasks (one task for each site). In the ith learning task, Xi = [xi1, xi2, …, xin] ∈ Rd×n is features of training samples, where d is the number of features and n is number of training samples, and their class labels are Yi = [yi1, yi2, …, yin] ∈ Rn, where yj ∈ {+1, −3} stands for NCs and SCZs, respectively. Let wi ∈ Rd denotes a feature weight vector for the ith learning task, and W = [w1, w2, …, wt] ∈ Rd×t denotes the feature weight matrix of all tasks. The columns of W (wi ∈ Rd) are the feature weights in each task, and the rows of W (wp ∈ Rt, where p = 1, 2,⋯, d) hold the weight vectors of each feature across all learning tasks. Our goal is to learn the feature weight matrix W by minimizing the following cost function:where  is the dot product of the feature weights and feature values in each training sample, and the first term in the objective function is the hinge loss cost of all training samples in all tasks, the second term ‖W‖1 = ∑i=1t|wi| is l1-norm of W, the last term ‖W‖2, 1 = ∑k=1d‖wk‖2 is a l2,1-norm penalty. The l1-norm term encourages task-specific sparsity, while l2,1-norm term encourages group sparsity among all tasks to identify task-shared features. The l2,1 + l1 regularization terms consider both the task-specific and task-shared features, which make multi-task learning more suitable in classification of the heterogeneous data. The optimal stochastic alternating direction method of multipliers (SADMM) was adopted to solve the optimization function. Details in the solution of the optimal problem using SADMM, and the converge prove can be found in.
In our study, the learning of feature weights at each data site was considered as a different task. Due to the sparse penalty constrains in the object function of multi-task learning, many elements in the feature weight matrix W were forced to zero, or approximately equal to zero. Weight values reflect the importance levels of different features in learning the classification boundaries between two groups, while weight values that are positive or negative tend to classify the sample into either positive or negative classes, respectively. We assume that features with larger weight coefficients (in terms of absolute value) contribute more in discriminating SCZ from NCs. Moreover, features with zero and near-zero weights make small contributions in the classification. Thus, in order to select the more important features for further classification, we sorted the weight vector in each data site according to their absolute values after the weights W were learned.
The consensus features in a small portion of the top-ranked features-which were set to 5% across three data sites, were considered as the site-shared features. The threshold of 5% was chosen because in terms of classification performance, it outperformed others in a range of 5%, 10%, and 20%. For a single data site, the site-specific and site-shared features were mixed together, as well as some irrelevant features. Using the multi-task feature learning scheme, the feature weights of the site-specific and site-shared features were obviously greater than the irrelevant features. Though the site-shared and site-specific features were both very important, the site-shared features were considered underlying the pathology of SCZ and more critical in characterizing disease alterations. Thus, to further emphasize the influence of site-shared features in the classification, we increased the weights of site-shared features using the following equation,where γ ≥ 1.
Note that the γ was not set to be a free parameter, which was also tuned using the nested-loop cross-validation in our study.
Classification with top ranked features.
The K top ranked features with the new feature weights were used to classify each dataset. The classifier equation is shown as follows.where wip denotes the new weight value of the pth feature in the ith data site, xp denotes the pth feature value, and y denotes the sample label. Given one testing sample in the ith data site, the dot product of the feature weights, and the feature values of the K selected features were summed up to get the sample label.
Validation experiments.
To evaluate the proposed method, ten comparison experiments were designed in the consideration of three aspects. (1) To show the effectiveness of gathering multi-site data, we reported the classification results of single-site, pooled, and multi-site data, respectively. Single-site classification learns features of each single-site data separately for classification; pooled classification pools the three data sites together as a larger dataset regardless of the site differences, which contributed to a simple binary classification of 150 controls and 150 patients; and multi-site classification uses multi-task learning to learn the site-specific and site-shared features simultaneously, in the three data sites, and combine the two types of features to classify each dataset separately. (2) To show the effectiveness of using multi-task feature learning framework, two widely used feature learning methods including principal component analysis (PCA) and two-sample t-test (ttest2) were also tested. (3) The proposed classifier based on the learned feature weights was compared to the SVM classifier with a linear kernel. Differences between these two classifiers exist as the SVM focuses on the selected features and calculates new feature weights for classification, while our proposed classifier takes advantage of the feature weights obtained in the feature learning step, and then generate the classification label. Table 2 listed the ten comparison methods in the current study.
In the first three experiments, the same proposed feature learning and classifier framework was applied in the multi-site, single-site and pooled data classification, respectively. In the single-site data classification, for each data site, we used the l1-norm feature selection, which included the hinge loss function and the l1-norm sparsity regularization term in the cost function. In the pooled data classification, the feature learning cost function was similar to the single-site classification, which considered the pooled data as a single cohort. Note that the feature learning framework applied in the single-site data classification and the pooled data classification was a special case of the multi-task feature learning framework, with the l2,1 sparsity regularization term disabled. The site-specific features were learned in the same way in all three classification experiments, while the site-shared features were only emphasized in multi-site learning, which could show the influence of site-shared features more clearly. The classifier for single-site data and pooled data classification was the same as Eq. (3), however, increasing weights of site-shared features in Eq. (2) was not applied as we did in multi-site learning, since there were no site-shared features in the single-site and pooled data classification.
In other seven experiments, the SVM classifier with a linear kernel was used after different feature learning methods. As shown in Table 2, the 4th to 6th experiments used the proposed multi-task feature learning technique, taking the feature learning method in single-site and pooled data as a special case of multi-site feature learning. In the 7th and 8th experiments, the PCA method was used, while in the 9th and 10th experiments, the ttest2 method was used in the single-site and pooled data classification, respectively.
The nested loop 5-fold cross-validation was used in the ten experiments to evaluate the classification performance. In specific, the samples were randomly separated into five subsets: one (20% of all samples) was used for testing, and the other four (80% of all samples) were divided further into two parts with the proportion rates of 80% (64% of all samples) and 20% (16% of all samples), respectively. The larger of the two parts was used as a training set, and the smaller part was used as a validation set, as described previously. The training samples were used for feature learning and classifier training, while the validation samples were used to tune all parameters with the trained classifier, and the best parameter set which contributed to the best classification accuracy of the validation samples was selected. Finally, the best parameters in the validation step were used to classify the testing samples and obtain the classification result. The whole process was repeated for 20 repeated experiments. The average accuracies of the 20 iterations for each site was considered as the final classification result.
The parameters of the multi-task feature learning framework were tuned by grid searching the regularization factors in the range of α, β ∈ {10−8, 10−6, 10−4, 10−2, 10−1, 0.3, 0.5, 1, 5, 10, 102, 103}, while in the special case of using multi-task feature learning in the single-site and pooled data, the l2,1-norm term was disabled and β was set to 0. In the proposed classifier in the multi-site classification (the first experiment), the ratio to increase the site-shared feature weights γ was tuned in the range of {1, 2, …, 100}. The number of selected features K ranged from {500, …, 20,000}, with the step-size of 100. In the experiments with the SVM classifier, the linear kernel was used and the cost value C was set to 1.
The site-shared and site-specific features were obtained in the multi-site classification, which used the proposed multi-task learning framework. After the parameter tuning, the best parameter set of the regulation terms α, β, the number of selected features K, and the site-shared feature increasing ratio γ were obtained. In each iteration, the best classification accuracy in each site corresponded to a specific W vector. We first calculated the mean W vectors of the 20 iterations that were contributed to the best accuracy in all three sites respectively, then the mean W vector of sites A, B, and C was obtained. The consensus features with weights that ranked the top 5% of the three sites were shown as the site-shared features, and the remaining features were considered as the site-specific features for each site, respectively. The feature weights of the site-shared and site-specific features were displayed using the Caret package, in which the clusters comprising of >50 voxels were shown.